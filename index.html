<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZelenyPath</title>
  <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Press+Start+2P&family=Orbitron&display=swap" rel="stylesheet">
  <style>
    :root{--neon-lime:#00C852;--crt-green:#33FF99;--deep-black:#0D0D0D;--hot-pink:#FF4081;--accent-blue:#00E5FF;--neutral-gray:#B0BEC5;}
    html,body{height:100%;margin:0;background:var(--deep-black);color:var(--neon-lime);font-family:'Share Tech Mono',monospace;overflow:hidden}
    #background-canvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1}
    .screen{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;opacity:0;transition:opacity .5s;z-index:2}
    #init-screen{opacity:1;z-index:3;flex-direction:column;justify-content:center;align-items:center}
    #surface-interface{display:none;background:transparent;padding:.5rem;box-sizing:border-box}
    .surface-container{width:100%;height:100%;border:2px solid var(--neon-lime);padding:1rem;display:grid;grid-template-rows:auto auto 1fr auto}
    .surface-header{display:flex;justify-content:space-between;border-bottom:2px solid var(--neon-lime);padding-bottom:.5rem}
    .logo{font-family:'Press Start 2P',monospace;font-size:1.2rem;color:var(--hot-pink);margin:0}
    .serial-number{font-size:1.2rem;color:var(--hot-pink)}
    .telegram-button{background:var(--neon-lime);color:var(--deep-black);padding:10px 15px;border:2px solid var(--neon-lime);text-decoration:none;font-family:'Press Start 2P',monospace;font-size:.8rem}
    .telegram-button:hover{background:var(--deep-black);color:var(--neon-lime)}
    #user-dashboard{display:none;text-align:center;color:#fff;width:90%}
    #qrcode-container{background:#fff;padding:10px;display:inline-block}
  </style>
</head>
<body>
  <canvas id="background-canvas"></canvas>

  <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <div id="init-screen" class="screen">
    <div id="log"></div>
    <div>
      <img src="img/main.svg" alt="logo" style="height:80px;filter:drop-shadow(0 0 15px var(--neon-lime))">
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
  <div id="surface-interface" class="screen">
    <div class="surface-container">
      <header class="surface-header">
        <div><p class="logo">PLASTFREI</p><p style="font-size:.7rem;color:var(--neutral-gray)">v1.3</p></div>
        <div id="ip-display"><span id="country-flag">üè¥</span> <span id="ip-address">127.0.0.1</span></div>
        <div><a href="#" style="color:var(--accent-blue)">INDEX</a></div>
      </header>

      <div id="telegram-login-container" style="text-align:center;margin:1rem 0"></div>

      <main style="display:flex;justify-content:center;align-items:center">
        <div id="user-dashboard">
          <h2 id="welcome-message" style="color:var(--hot-pink);font-family:'Press Start 2P'"></h2>
          <p>–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏: <strong id="sub-status" style="color:var(--crt-green)"></strong></p>

          <div style="display:flex;flex-wrap:wrap;justify-content:center;gap:2rem">
            <div>
              <h4>–ö–ª—é—á –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h4>
              <div id="qrcode-container"></div>
              <code id="connection-key" style="background:#333;padding:5px;display:block;word-break:break-all"></code>
            </div>
            <div style="text-align:left">
              <h4>–í–∞—à —Ç–∞—Ä–∏—Ñ: <span id="tariff-name"></span></h4>
              <ul id="tariff-details-list" style="list-style:none;padding:0"></ul>
            </div>
          </div>
        </div>
      </main>

      <footer style="display:flex;justify-content:space-between;border-top:2px solid var(--neon-lime);padding-top:1rem">
        <span class="serial-number">S/N: 7G-PLAST-95</span>
        <a href="https://t.me/plastfreivpn_bot" target="_blank" class="telegram-button">TELEGRAM</a>
      </footer>
    </div>
  </div>

  <script>
    /* ---------- 1. –ö–û–ù–§–ò–ì ---------- */
    const API_URL   = 'https://plastfrei-ulum.vercel.app/api/get_user_info';
    const BOT_NAME  = 'plastfreivpn_bot';

    /* ---------- 2. –ê–Ω–∏–º–∞—Ü–∏—è —Ñ–æ–Ω–∞ ---------- */
    const canvas = document.getElementById('background-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = innerWidth; canvas.height = innerHeight;
    const cols = canvas.width / 16, drops = Array(cols).fill(1);
    const chars = '„Ç¢„Ç°„Ç´„Çµ„Çø„Éä„Éè„Éû„É§„É£„É©„ÉØ„Ç¨„Ç∂„ÉÄ„Éê„ÉëABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    function drawMatrix() {
      ctx.fillStyle='rgba(13,13,13,.05)';ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle='var(--neon-lime)';ctx.font='16px monospace';
      drops.forEach((y,i)=>{
        const text = chars[Math.floor(Math.random()*chars.length)];
        ctx.fillText(text,i*16,y*16);
        if(y*16>canvas.height && Math.random()>.975) drops[i]=0;
        drops[i]++;
      });
      requestAnimationFrame(drawMatrix);
    }
    drawMatrix();

    /* ---------- 3. –õ–æ–≥–∏–∫–∞ Telegram ---------- */
    function onTelegramAuth(user){
      fetch(API_URL, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(user)})
        .then(r=>r.json()).then(d=>{
          if(d.status!=='ok') throw new Error(d.message||'no data');
          document.getElementById('welcome-message').textContent=`–ü—Ä–∏–≤–µ—Ç, ${d.first_name}!`;
          document.getElementById('sub-status').textContent=`–ê–∫—Ç–∏–≤–µ–Ω –¥–æ ${new Date(d.subscription_end).toLocaleString()}`;
          document.getElementById('tariff-name').textContent=d.tariff_details.name;
          document.getElementById('tariff-details-list').innerHTML=
            `<li>–°–∫–æ—Ä–æ—Å—Ç—å: ${d.tariff_details.speed}</li>
             <li>–ü–∏–Ω–≥: ${d.tariff_details.ping}</li>
             <li>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${d.tariff_details.connections}</li>
             <li>–†–µ–≥–∏–æ–Ω: ${d.tariff_details.region}</li>`;
          document.getElementById('connection-key').textContent=d.keys[0];
          new QRCode(document.getElementById('qrcode-container'),{text:d.keys[0],width:180,height:180});
          document.getElementById('user-dashboard').style.display='block';
        });
    }

    /* ---------- 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞ ---------- */
    window.addEventListener('load',()=>{
      const login=document.getElementById('telegram-login-container');
      login.innerHTML='';
      const s=document.createElement('script');
      s.src='https://telegram.org/js/telegram-widget.js?22';
      s.setAttribute('data-telegram-login',BOT_NAME);
      s.setAttribute('data-size','large');
      s.setAttribute('data-auth-url',API_URL);
      s.setAttribute('data-onauth','onTelegramAuth');
      s.setAttribute('data-request-access','write');
      login.appendChild(s);

      /* —Å–∫—Ä—ã—Ç—å –∑–∞—Å—Ç–∞–≤–∫—É */
      setTimeout(()=>{
        document.getElementById('init-screen').style.opacity=0;
        setTimeout(()=>{document.getElementById('init-screen').style.display='none';},500);
        document.getElementById('surface-interface').style.display='flex';
        document.getElementById('surface-interface').style.opacity=1;
      },2500);
    });
  </script>
</body>
</html>
