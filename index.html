<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Минимальный Тест Telegram</title>
    <style>
        body { font-family: sans-serif; background-color: #222; color: white; text-align: center; padding-top: 50px; }
    </style>
</head>
<body>

    <h1>Тестовая страница для входа</h1>
    <p>Если вы видите кнопку входа ниже (без ошибки), значит, проблема была в коде основного сайта. Если ошибка осталась — проблема на стороне Telegram.</p>

    <div id="telegram-login-container"></div>

    <script>
        // --- КОНФИГУРАЦИЯ ---
        const API_URL = 'https://c6fcfa7f5b70.ngrok-free.app/api/get_user_info'; 
        const BOT_USERNAME = 'plastfreivpn_bot';

        // --- ЛОГИКА ---
        function onTelegramAuth(user) {
            // Эта функция просто покажет, что вход прошел успешно
            alert('ВХОД УСПЕШЕН! Пользователь: ' + user.first_name);
            console.log("Получены данные от Telegram:", user);
            
            // Здесь можно добавить логику fetch для проверки API, если нужно
        }

        // --- ИНИЦИАЛИЗАЦИЯ ВИДЖЕТА ---
        window.addEventListener('load', () => {
            const container = document.getElementById('telegram-login-container');
            const script = document.createElement('script');
            script.src = 'https://telegram.org/js/telegram-widget.js?22';
            script.setAttribute('data-telegram-login', BOT_USERNAME);
            script.setAttribute('data-size', 'large');
            script.setAttribute('data-onauth', 'onTelegramAuth(user)');
            script.setAttribute('data-request-access', 'write');
            container.appendChild(script);
        });
    </script>

</body>
</html>
